#include <algorithm>
#include <array>
#include <iomanip>
#include <iostream>
#include <limits>
#include <map>
#include <numeric>
#include <optional>
#include <set>
#include <sstream>
#include <tuple>
#include <vector>
#include <deque>

#ifdef NDEBUG
#undef NDEBUG
#endif
#include <assert.h>

#define ASSERT_EQ(a, b)                                   \
    do                                                    \
    {                                                     \
        __typeof__(a) _a = (a);                           \
        __typeof__(b) _b = (b);                           \
        if (_a != _b)                                     \
        {                                                 \
            std::cout << _a << " != " << _b << std::endl; \
            assert(0);                                    \
        }                                                 \
    } while (0)

#define myprint(arg)                                       \
    do                                                     \
    {                                                      \
        std::cout << "" #arg << " = " << arg << std::endl; \
    } while (0)

using ll = int64_t;

namespace
{

    std::vector<std::string> input_real{
        "......................................................................S......................................................................",
        ".............................................................................................................................................",
        "......................................................................^......................................................................",
        ".............................................................................................................................................",
        ".....................................................................^.^.....................................................................",
        ".............................................................................................................................................",
        "....................................................................^...^....................................................................",
        ".............................................................................................................................................",
        "...................................................................^.^.^.^...................................................................",
        ".............................................................................................................................................",
        "..................................................................^...^.^.^..................................................................",
        ".............................................................................................................................................",
        ".................................................................^.^.^.^.^.^.................................................................",
        ".............................................................................................................................................",
        "................................................................^.^...^.^.^.^................................................................",
        ".............................................................................................................................................",
        "...............................................................^.^.^...^...^.^...............................................................",
        ".............................................................................................................................................",
        "..............................................................^.^...^.^.^.^...^..............................................................",
        ".............................................................................................................................................",
        ".............................................................^.....^...^.^.^.^.^.............................................................",
        ".............................................................................................................................................",
        "............................................................^.^.^.^.^...^.^.^...^............................................................",
        ".............................................................................................................................................",
        "...........................................................^.....^.^.^.^...^...^.^...........................................................",
        ".............................................................................................................................................",
        "..........................................................^.^...^.......^.^.^.^.^.^..........................................................",
        ".............................................................................................................................................",
        ".........................................................^.^.^.^.^.^.^.^.^.^...^.^.^.........................................................",
        ".............................................................................................................................................",
        "........................................................^.......^.^.^.^...^.^...^.^.^........................................................",
        ".............................................................................................................................................",
        ".......................................................^.^.^.^...^.^...^...^...^...^.^.......................................................",
        ".............................................................................................................................................",
        "......................................................^.^...^.^.^.^...^.....^.^.^.^.^.^......................................................",
        ".............................................................................................................................................",
        ".....................................................^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....................................................",
        ".............................................................................................................................................",
        "....................................................^.^.^...^.^.^.^...^.^...^.^...^...^.^....................................................",
        ".............................................................................................................................................",
        "...................................................^.^.^.^.^.......^.^.^.^.^.^...^.^...^.^...................................................",
        ".............................................................................................................................................",
        "..................................................^.......^...^.^.^...^.....^.^.........^.^..................................................",
        ".............................................................................................................................................",
        ".................................................^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.....^.^.................................................",
        ".............................................................................................................................................",
        "................................................^...^.^...^.^.^.......^.....^...^...^.....^.^................................................",
        ".............................................................................................................................................",
        "...............................................^.^.^...^.^...^...^.....^...^.^.^.^.^...^.^.^.^...............................................",
        ".............................................................................................................................................",
        "..............................................^.......^.^.^.^...^.^.....^...^.^.^.^.^.^.^.^.^.^..............................................",
        ".............................................................................................................................................",
        ".............................................^.^...^.^.^...^.^.^.^.^...^.^.^.^.........^.^.^.^.^.............................................",
        ".............................................................................................................................................",
        "............................................^.^.^.^.....^...^.....^.^.^.^...^.^.^.^...^...^.^.^.^............................................",
        ".............................................................................................................................................",
        "...........................................^.....^.^.^.......^.....^.^...^.^.^.^.^.^.^.^...^.^.^.^...........................................",
        ".............................................................................................................................................",
        "..........................................^.^.^.^.^.^...^.^.^.....^.^.....^...^.^.^.^.....^.^.^...^..........................................",
        ".............................................................................................................................................",
        ".........................................^.^.^.^...............^.^.^...^.^.........^.^.^...^.^...^.^.........................................",
        ".............................................................................................................................................",
        "........................................^.^.^.^.^.^.^...^.^.^...^...^.^.^.^.^.^.^.^...^.^.....^.^.^.^........................................",
        ".............................................................................................................................................",
        ".......................................^...^.^.^.^.^.^.^.^...^...^.^.^.......^.^.^.^.^.^.........^...^.......................................",
        ".............................................................................................................................................",
        "......................................^.^.^.^.^.^...^.^.^.......^.....^...^.^.......^.^...^.^.^...^...^......................................",
        ".............................................................................................................................................",
        ".....................................^.^.^.^.^.....^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.....................................",
        ".............................................................................................................................................",
        "....................................^...^.^.^.^.^...^.^.^.^.........^.^.^.^.^.^.^...^.^.^.^...^.^...^...^....................................",
        ".............................................................................................................................................",
        "...................................^.^.^...^.^.^.^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.....^.^...................................",
        ".............................................................................................................................................",
        "..................................^.^...^.......^.^.^.^...^...^.^.....^.......^.^.^...^...^.^.^.^.^.^.^.^.^..................................",
        ".............................................................................................................................................",
        ".................................^.^.....^...^.^.^...^...^.^.^.......^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^.................................",
        ".............................................................................................................................................",
        "................................^.....^.^.^...^.^...^...^...^.^.^.^...^.^.^.^...^.^...^.^.^.^...^.^.^...^...^................................",
        ".............................................................................................................................................",
        "...............................^.^.^.^.^.......^...^.^...^...^.^.^.^.^.^...^.^.^.....^.^.^.^.^.......^.....^.^...............................",
        ".............................................................................................................................................",
        "..............................^...^...^.....^.^...^.^.^.^...^.^.^...^.^...^.^.^.^.^.^...^...^.^.^.........^.^.^..............................",
        ".............................................................................................................................................",
        ".............................^.^.....^.....^...^.^.^.^...^.....^...^.^.^...^...^.^...^.^...^.^.^.^.^.^.^...^...^.............................",
        ".............................................................................................................................................",
        "............................^.^.^...^.^...^.^.^...^.^.^...^.^.^.^.....^...^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^...^............................",
        ".............................................................................................................................................",
        "...........................^.^.^.......^.^.^.^.^...^.^.^.^.^...^.....^.^.^.^.^.^...^...^.^.^.^.^.^.^...^.^.^...^.^...........................",
        ".............................................................................................................................................",
        "..........................^.^.....^...^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^...^...^.^...^.^.^...^.^.^..........................",
        ".............................................................................................................................................",
        ".........................^.^...^.^.^...^.^.^.^.^...^.^...^.............^.^.^.^.......^.^.^.^.^...^.^.^...^.^.^.^.^.^.........................",
        ".............................................................................................................................................",
        "........................^.^.........^.^.^.^.^.^...^.......^...^.^.^...^.^.^.....^.^.^.......^.....^.^.^.^.^.^.^.^.^.^........................",
        ".............................................................................................................................................",
        ".......................^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^.^.....^.^...^.^.^.^...^.^.^.^.......................",
        ".............................................................................................................................................",
        "......................^.^.^.^.......^.^.^...^.^...^.^...^...^.^...^...^.....^.^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^......................",
        ".............................................................................................................................................",
        ".....................^.^.^.^...^...^...^.^.^.....^.^.^.^...^...^.^.^.^.^.........^.^.^...^.^.^.^.....^.^.^...^.^...^.^.^.....................",
        ".............................................................................................................................................",
        "....................^.^.^...^...^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.....^...^.^.^.^.......^...^.^.^.^.^.^...^.^.^...^.^...^....................",
        ".............................................................................................................................................",
        "...................^.^...^.^.^.^.^...^.^.^.^...^.^.^.^.^.^...^.^...^...^.^.^.^.......^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...................",
        ".............................................................................................................................................",
        "..................^.^.^.^...^.....^.^...^...^.....^.....^.^...^...^...^.^.......^.........^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^..................",
        ".............................................................................................................................................",
        ".................^.^.^.^.^.^.^...^.^.^...^...^.^.^.^.^.^.^.^.^.....^.^...^.....^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.................",
        ".............................................................................................................................................",
        "................^.......^.^.^.^...^.^...^.^.^.^.^.^.^.......^.^.^.^.^.....^.^.^.^.^.^.....^.^.^...^...^.^.^...^.^.....^.^.^.^................",
        ".............................................................................................................................................",
        "...............^.^.^.^.^.^.......^.^.^.......^.^.^...^.^.....^.^.........^.........^.^...^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^...............",
        ".............................................................................................................................................",
        "..............^.^.^.^.^.....^.^.^.^.^.....^.^.^.^.^.^.^...^.^...^...^.^.^...^.^.^...^...^...^.^.^.^.^.^.^.........^.^.^.^.^.^.^..............",
        ".............................................................................................................................................",
        ".............^.^.^.^.^.....^.^...^.^.^.....^.^.....^...^.^.....^.^.^...^.^.^.^...^...^.....^.^.^...^...^.^.....^.....^.....^...^.............",
        ".............................................................................................................................................",
        "............^.^.....^.^.^.^.^.^.^.^.^.....^...^.^.....^.^.^.^.^...^...^.^.^.^.^.^.^...^...^.....^.........^.....^.^.^.^.^.^...^.^............",
        ".............................................................................................................................................",
        "...........^.^...^.^.^.^...^.......^...^.^.^.^.....^.^.^.^.^.....^.^.^.^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^...^...........",
        ".............................................................................................................................................",
        "..........^...^.^.^.^.........^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.....^...^...^...^.^.^.^...^...^...^...^...^.......^...^...^.^...^.^..........",
        ".............................................................................................................................................",
        ".........^...^.^.^...^.^.^.^...^.^.^...^.^...^.^.^.^.^...^.^.^.^.^.^.^...^.^...^.....^.^.....^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.........",
        ".............................................................................................................................................",
        "........^.^...^.......^...^...^...^...^.........^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^...^.^...^.^.....^........",
        ".............................................................................................................................................",
        ".......^...^.^.....^.^.^.^.^.^.^...^...^.^.^.^.....^.^.^...^.^.^...^.^...^...^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^.^.^...^.^.^.^.^.^.^.^.......",
        ".............................................................................................................................................",
        "......^.^.^.........^.^.^...^...^.^...^.^.^.^...^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^......",
        ".............................................................................................................................................",
        ".....^.^.....^.^...^.^.^...^...^.^.^.........^.^.^...^.^...^.^.^.^.^.^.^...^...^.^.^.^...^.^...^.^.^.^.^.^.^.^.^...^.^...^.^...^.^.....^.....",
        ".............................................................................................................................................",
        "....^.^.^.....^...^.^.^.^.....^.....^...^.......^.^...^...^...^.^.^.^.^.....^.^.....^.^...^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^...^....",
        ".............................................................................................................................................",
        "...^.^...^.^...^.^.^.^...^.^.......^.^.^.^.^...^...^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^...^...",
        ".............................................................................................................................................",
        "..^.^.^.^.^.....^...^.^.^.^...^.^...^...^.^.^.^...^...^...^.^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^...^...^...^..",
        ".............................................................................................................................................",
        ".^.^...^.^.^...^.....^.^.^...^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^...^...^.^.^.....^.^...^...^.^.^.^.^.^.^.^.",
        "............................................................................................................................................."};

    decltype(input_real) input_test{
        ".......S.......",
        ".......|.......",
        "......|^|......",
        "......|.|......",
        ".....|^|^|.....",
        ".....|.|.|.....",
        "....|^|^|^|....",
        "....|.|.|.|....",
        "...|^|^|||^|...",
        "...|.|.|||.|...",
        "..|^|^|||^|^|..",
        "..|.|.|||.|.|..",
        ".|^|||^||.||^|.",
        ".|.|||.||.||.|.",
        "|^|^|^|^|^|||^|",
        "|.|.|.|.|.|||.|"};
    // auto &input = input_test;
    auto &input = input_real;
}

int main7()
{
    int64_t result0 = 0;
    int64_t result1 = 0;

    const ll width = input.at(0).size();
    ll s = 0;

    for (; s < width; s++)
    {
        if (input.at(0).at(s) == 'S')
        {
            break;
        }
    }

    std::set<std::tuple<ll, ll>> prisms;
    std::set<std::tuple<ll, ll>> splits;
    std::deque<std::tuple<ll, ll>> beam_queue;
    beam_queue.push_back({s, 1});

    while (!beam_queue.empty())
    {
        auto [x, y] = beam_queue.back();
        beam_queue.pop_back();
        for (ll j = y; j < input.size(); j++)
        {
            auto c = input.at(j).at(x);
            if (c == '^')
            {
                prisms.insert({x, j});
                bool split = false;
                if (x - 1 > 0)
                {
                    auto [it, inserted] = splits.insert({x - 1, j});
                    split |= inserted;
                    if (inserted)
                    {
                        beam_queue.push_back({x - 1, j});
                    }
                }
                if (x + 1 < width)
                {
                    auto [it, inserted] = splits.insert({x + 1, j});
                    split |= inserted;
                    if (inserted)
                    {
                        beam_queue.push_back({x + 1, j});
                    }
                }
                break;
            }
        }
    }

    result0 = prisms.size();

    for (ll j = 0; j < input.size(); j++)
    {
        for (ll i = 0; i < width; i++)
        {
            if (!prisms.count({i, j}))
            {
                input.at(j).at(i) = '.';
            }
        }
    }

    std::vector<std::vector<ll>> matrix(input.size());
    for (auto &m : matrix)
    {
        m.resize(width);
    }

    for (ll i = 0; i < width; i++)
    {
        if (input.at(input.size() - 2).at(i) != '^')
        {
            matrix.at(input.size() - 1).at(i) = 1;
        }
    }
    for (ll j = input.size() - 2; j >= 1; j--)
    {
        for (ll i = 0; i < width; i++)
        {
            if (input.at(j).at(i) == '^')
            {
                ll nr_of_splits = 0;
                if (i - 1 >= 0)
                {
                    nr_of_splits += matrix.at(j + 1).at(i - 1);
                }
                if (i + 1 < width)
                {
                    nr_of_splits += matrix.at(j + 1).at(i + 1);
                }
                matrix.at(j).at(i) = nr_of_splits;
            }
            else
            {
                matrix.at(j).at(i) = matrix.at(j + 1).at(i);
            }
        }
    }

    result1 = matrix.at(1).at(s);

    myprint(result0);
    myprint(result1);
    return 0;
}
